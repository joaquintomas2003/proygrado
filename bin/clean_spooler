#!/usr/bin/env bash
set -euo pipefail

SPOOL_DIRS=("/var/spool/int" "/var/spool/event")

for DIR in "${SPOOL_DIRS[@]}"; do
  echo "â†’ Cleaning $DIR ..."

  # Remove empty files
  find "$DIR" -type f -size 0 -print -delete

  # Remove lingering .open files (Filebeat ignores them anyway)
  find "$DIR" -type f -name '*.open' -print -delete

  # Remove files older than 1 day (already ingested by Filebeat)
  # These should already have been ingested by Filebeat
  find "$DIR" -type f -name '*.ndjson' -mtime +1 -print -delete
done